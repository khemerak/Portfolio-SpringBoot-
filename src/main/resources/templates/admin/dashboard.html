<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Dashboard | Portfolio</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous" />
</head>

<body class="admin-body">

    <!-- ══ NAVBAR ══ -->
    <nav class="navbar" id="navbar">
        <a th:href="@{/}" class="nav-brand">&#128187; Portfolio Admin</a>
        <ul class="nav-links" style="display:flex;">
            <li>
                <a th:href="@{/}" target="_blank">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i> View Site
                </a>
            </li>
            <li>
                <form th:action="@{/logout}" method="post" style="margin:0;">
                    <button type="submit" class="btn-login" style="cursor:pointer; border:none;">
                        <i class="fa-solid fa-right-from-bracket"></i> Logout
                    </button>
                </form>
            </li>
        </ul>
    </nav>

    <!-- ══ ADMIN HEADER ══ -->
    <div class="admin-header">
        <div class="admin-header-title">
            <i class="fa-solid fa-gauge-high"></i> Content Management
        </div>
        <div style="font-size: 0.85rem; color: var(--text-muted);">
            Logged in as: <strong sec:authentication="name" style="color: var(--accent-light);">admin</strong>
        </div>
    </div>

    <div class="admin-content">

        <!-- ── Flash messages ── -->
        <div class="alert-success" th:if="${successInfo}">
            <i class="fa-solid fa-check-circle"></i>
            <span th:text="${successInfo}"></span>
        </div>
        <div class="alert-success" th:if="${successProject}">
            <i class="fa-solid fa-check-circle"></i>
            <span th:text="${successProject}"></span>
        </div>

        <!-- ══ ROW 1: Site Info + Profile ══ -->
        <form th:action="@{/admin/info}" method="post" class="admin-form">
            <div class="admin-grid">

                <!-- Site Info Card -->
                <div class="admin-card">
                    <div class="admin-card-title">
                        <i class="fa-solid fa-user-circle"></i> Site Information
                    </div>
                    <div class="form-group">
                        <label class="form-label">Your Name</label>
                        <input class="form-input" type="text" name="name" th:value="${info.name}"
                            placeholder="Alex Johnson" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Professional Title</label>
                        <input class="form-input" type="text" name="title" th:value="${info.title}"
                            placeholder="Full-Stack Developer" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hero Headline</label>
                        <input class="form-input" type="text" name="headline" th:value="${info.headline}"
                            placeholder="I build amazing things..." />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Years of Experience</label>
                        <input class="form-input" type="number" name="experienceYears"
                            th:value="${info.experienceYears}" placeholder="5" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">About Me</label>
                        <textarea class="form-input" name="aboutMe" th:text="${info.aboutMe}"
                            placeholder="Tell your story..."></textarea>
                    </div>
                </div>

                <!-- Links Card -->
                <div class="admin-card">
                    <div class="admin-card-title">
                        <i class="fa-solid fa-link"></i> Links &amp; Contact
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-solid fa-image"></i> Profile Image URL</label>
                        <input class="form-input" type="url" name="profileImageUrl" th:value="${info.profileImageUrl}"
                            placeholder="https://..." />
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-solid fa-file-pdf"></i> CV / Resume URL</label>
                        <input class="form-input" type="url" name="cvUrl" th:value="${info.cvUrl}"
                            placeholder="https://..." />
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-solid fa-envelope"></i> Email</label>
                        <input class="form-input" type="email" name="email" th:value="${info.email}"
                            placeholder="hello@example.com" />
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-solid fa-location-dot"></i> Location</label>
                        <input class="form-input" type="text" name="location" th:value="${info.location}"
                            placeholder="San Francisco, CA" />
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-solid fa-briefcase"></i> Current Status</label>
                        <input class="form-input" type="text" name="currentStatus" th:value="${info.currentStatus}"
                            placeholder="Open to Opportunities" />
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-solid fa-graduation-cap"></i> Education</label>
                        <input class="form-input" type="text" name="education" th:value="${info.education}"
                            placeholder="B.S. Computer Science" />
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-brands fa-github"></i> GitHub URL</label>
                        <input class="form-input" type="url" name="githubUrl" th:value="${info.githubUrl}"
                            placeholder="https://github.com/..." />
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-brands fa-linkedin"></i> LinkedIn URL</label>
                        <input class="form-input" type="url" name="linkedinUrl" th:value="${info.linkedinUrl}"
                            placeholder="https://linkedin.com/in/..." />
                    </div>
                    <div class="form-group">
                        <label class="form-label"><i class="fa-brands fa-x-twitter"></i> Twitter / X URL</label>
                        <input class="form-input" type="url" name="twitterUrl" th:value="${info.twitterUrl}"
                            placeholder="https://twitter.com/..." />
                    </div>
                    <div class="admin-form-actions">
                        <button type="submit" class="btn-save">
                            <i class="fa-solid fa-floppy-disk"></i> Save Information
                        </button>
                    </div>
                </div>

            </div><!-- /admin-grid -->
        </form>

        <!-- ══ ADDED: Credentials Form ══ -->
        <form th:action="@{/admin/credentials}" method="post" class="admin-form">
            <div class="alert-success" th:if="${successCredentials}">
                <i class="fa-solid fa-check-circle"></i>
                <span th:text="${successCredentials}"></span>
            </div>
            <div class="alert-success" th:if="${errorCredentials}"
                style="background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.25); color: #f87171;">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span th:text="${errorCredentials}"></span>
            </div>
            <div class="admin-card" style="margin-bottom: 2rem;">
                <div class="admin-card-title">
                    <i class="fa-solid fa-key"></i> Admin Credentials
                </div>
                <div class="admin-grid">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input class="form-input" type="text" name="username" th:value="${credentialsForm.username}"
                            required />
                    </div>
                    <div class="form-group">
                        <label class="form-label">New Password</label>
                        <input class="form-input" type="password" name="newPassword"
                            placeholder="Leave blank to keep current password" />
                    </div>
                </div>
                <div class="admin-form-actions">
                    <button type="submit" class="btn-save">
                        <i class="fa-solid fa-lock"></i> Update Credentials
                    </button>
                </div>
            </div>
        </form>

        <!-- ══ ROW 2: Add/Edit Project Form ══ -->
        <form th:action="@{/admin/projects/save}" method="post" class="admin-form">
            <div class="admin-card" style="margin-bottom: 2rem;">
                <div class="admin-card-title">
                    <i class="fa-solid fa-folder-plus"></i>
                    <span th:text="${editMode} ? 'Edit Project' : 'Add New Project'">Add New Project</span>
                </div>
                <!-- Hidden id for edit mode -->
                <input type="hidden" name="id" th:value="${newProject.id}" />
                <div class="admin-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label">Project Title *</label>
                            <input class="form-input" type="text" name="title" th:value="${newProject.title}"
                                placeholder="My Awesome Project" required />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-input" name="description" th:text="${newProject.description}"
                                placeholder="Describe what this project does..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tech Tags <span
                                    style="color:var(--text-muted)">(comma-separated)</span></label>
                            <input class="form-input" type="text" name="techTags" th:value="${newProject.techTags}"
                                placeholder="Spring Boot, React, PostgreSQL" />
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label class="form-label">Project URL</label>
                            <input class="form-input" type="url" name="projectUrl" th:value="${newProject.projectUrl}"
                                placeholder="https://github.com/..." />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Image URL</label>
                            <input class="form-input" type="url" name="imageUrl" th:value="${newProject.imageUrl}"
                                placeholder="https://images.unsplash.com/..." />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Display Order</label>
                            <input class="form-input" type="number" name="displayOrder"
                                th:value="${newProject.displayOrder}" placeholder="1" min="1" />
                        </div>
                        <div class="admin-form-actions">
                            <a th:if="${editMode}" th:href="@{/admin/dashboard}" class="btn-outline btn btn-sm"
                                style="margin-right: 0.75rem;">
                                Cancel
                            </a>
                            <button type="submit" class="btn-save">
                                <i class="fa-solid fa-floppy-disk"></i>
                                <span th:text="${editMode} ? 'Update Project' : 'Add Project'">Add Project</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- ══ ROW 3: Projects Table ══ -->
        <div class="admin-card admin-card-full">
            <div class="admin-card-title">
                <i class="fa-solid fa-list"></i> Manage Projects
                (<span th:text="${projects.size()}">0</span> total)
            </div>

            <div th:if="${#lists.isEmpty(projects)}"
                style="text-align:center; padding: 2rem; color: var(--text-muted);">
                No projects yet. Use the form above to add your first one!
            </div>

            <table class="projects-table" th:unless="${#lists.isEmpty(projects)}">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Title</th>
                        <th>Tech Tags</th>
                        <th>Order</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="p, stat : ${projects}">
                        <td th:text="${stat.index + 1}">1</td>
                        <td>
                            <strong th:text="${p.title}">Title</strong>
                            <div style="font-size: 0.78rem; color: var(--text-muted); margin-top: 2px;"
                                th:text="${#strings.abbreviate(p.description, 60)}">Desc...</div>
                        </td>
                        <td>
                            <div style="display:flex; flex-wrap:wrap; gap:0.35rem;">
                                <span class="tech-tag" th:each="tag : ${p.techTagArray}"
                                    th:text="${#strings.trim(tag)}">Tag</span>
                            </div>
                        </td>
                        <td th:text="${p.displayOrder}">1</td>
                        <td>
                            <div class="table-actions">
                                <a th:href="@{/admin/projects/{id}/edit(id=${p.id})}" class="btn-edit">
                                    <i class="fa-solid fa-pen"></i> Edit
                                </a>
                                <form th:action="@{/admin/projects/{id}/delete(id=${p.id})}" method="post"
                                    style="display:inline;" onsubmit="return confirm('Delete this project?');">
                                    <button type="submit" class="btn-danger">
                                        <i class="fa-solid fa-trash"></i> Delete
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div><!-- /admin-content -->

    <script>
        // Navbar scroll effect
        const navbar = document.getElementById('navbar');
        window.addEventListener('scroll', () => {
            navbar.classList.toggle('scrolled', window.scrollY > 20);
        });
    </script>
</body>

</html>